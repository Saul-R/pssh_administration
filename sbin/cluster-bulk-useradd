#!/bin/bash
DIR="$(dirname "$(readlink -f "$0")")"
source $DIR/../conf/cluster-admin-env.sh

usage="Usage: $0 [options] <number of users>\n
Options:\n
\t--user-prefix <prefix>: The prefix of the name for the users created. (default = user)\n
\t--password-file <prefix>: The file to store autogenerated password for each user. (default = ./passwords)"

user_prefix="user"
pass_file="passwords"
while [ $# -gt 1 ]
do
  arg=$1
  case $arg in
    --user-prefix )
	user_prefix=$2
	shift
    ;;
    --password-file )
        pass_file=$2
        shift
    ;;
    *)
      echo -e $usage
      exit 1
    ;;
  esac
  shift
done

if [ $# -lt 1 ];then
	echo -e $usage
	exit 1
fi
num_users=$1
sudo rm -f $pass_file
for (( i=1; i<=num_users; i++ ))
do
	echo "Adding user $i..."
	passwd=$(apg -a 0 -n1)
	echo -e "$passwd\n$passwd"|./cluster-useradd $user_prefix$i &>/dev/null
	echo $user_prefix$i:$passwd >> $pass_file
	echo "User $user_prefix$i added."
done
sudo chmod 400 $pass_file 
